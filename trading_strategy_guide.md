# 자동매매 파인스크립트 전략 가이드

## 📋 전략 개요

이 파인스크립트는 제공된 트레이딩 플랜과 플로우차트를 기반으로 구현된 체계적인 자동매매 전략입니다. 트렌드 추종과 지지/저항 레벨을 활용한 진입/청산 시스템을 포함합니다.

## 🎯 핵심 특징

### 1. Trade Entries & Exits (진입 및 청산)
- **트렌드 확인**: 이중 이동평균을 통한 트렌드 방향 판단
- **진입 조건**: 트렌드 + 지지/저항 레벨 + 볼륨 확인
- **청산 조건**: 손절/익절 + 트레일링 스톱 + 긴급 청산

### 2. Risk Control (리스크 관리)
- **포지션 크기**: 켈리 공식 기반 최적 포지션 사이징
- **손절/익절**: 고정 비율 기반 자동 청산
- **일일 손실 한도**: 일일 최대 손실률 제한
- **최대 포지션 수**: 동시 보유 가능한 포지션 수 제한

### 3. Market Focus (시장 집중)
- **거래 세션 필터**: 특정 시간대에만 거래 실행
- **시간대 설정**: 한국 시장 기준 09:00-15:00 기본 설정

### 4. Market Conditions (시장 상황)
- **변동성 측정**: ATR 기반 시장 변동성 모니터링
- **볼륨 분석**: 평균 볼륨 대비 급증 확인
- **RSI 필터**: 과매수/과매도 구간 진입 방지

### 5. Growth & Goals (성장 및 목표)
- **성과 추적**: 실시간 수익률, 승률, 최대손실 모니터링
- **최적화**: 백테스팅 결과 기반 파라미터 조정

## ⚙️ 설정 매개변수

### Trade Entries & Exits 그룹
```pinescript
- 트렌드 판단 기간: 20 (5-100)
- 빠른 이동평균: 10 (5-50)
- 느린 이동평균: 20 (10-100)
```

### Risk Control 그룹
```pinescript
- 포지션 크기 (%): 2.0 (0.5-10.0)
- 손절 비율 (%): 2.0 (0.5-10.0)
- 익절 비율 (%): 4.0 (1.0-20.0)
- 일일 최대 손실 (%): 5.0 (1.0-20.0)
- 최대 포지션 수: 3 (1-10)
```

### Market Focus 그룹
```pinescript
- 세션 필터 사용: true
- 거래 세션: "0900-1500"
```

### Market Conditions 그룹
```pinescript
- 변동성 기간: 14 (5-50)
- 볼륨 임계값: 1.5 (1.0-3.0)
```

## 🔄 트레이딩 플로우차트 로직

### 매수 조건 (Long Entry)
1. **트렌드 확인**: 상승 트렌드 (빠른MA > 느린MA, 종가 > 느린MA)
2. **지지선 근처**: 현재가가 지지선 1% 이내
3. **볼륨 급증**: 현재 볼륨이 평균 볼륨의 1.5배 이상
4. **RSI 필터**: RSI < 70 (과매수 아님)
5. **세션 내**: 거래 시간 내

### 매도 조건 (Short Entry)
1. **트렌드 확인**: 하락 트렌드 (빠른MA < 느린MA, 종가 < 느린MA)
2. **저항선 근처**: 현재가가 저항선 1% 이내
3. **볼륨 급증**: 현재 볼륨이 평균 볼륨의 1.5배 이상
4. **RSI 필터**: RSI > 30 (과매도 아님)
5. **세션 내**: 거래 시간 내

### 대기 조건 (Wait)
- 사이드웨이 시장
- 지지/저항선 근처가 아닌 경우
- 볼륨 부족
- 거래 시간 외

## 📊 리스크 관리 시스템

### 1. 포지션 사이징
- **켈리 공식 적용**: 과거 성과 기반 최적 포지션 크기 계산
- **최대 한도**: 설정된 최대 포지션 크기 초과 방지

### 2. 손절/익절
- **고정 비율**: 진입가 기준 고정 비율로 설정
- **자동 실행**: strategy.exit() 함수로 자동 청산

### 3. 긴급 청산
- **롱 포지션**: 종가가 빠른MA의 95% 이하 또는 RSI > 80
- **숏 포지션**: 종가가 빠른MA의 105% 이상 또는 RSI < 20

### 4. 일일 손실 제한
- **추적**: 일별 손익 누적 계산
- **제한**: 설정된 일일 최대 손실률 도달 시 거래 중단

## 📈 시각화 요소

### 차트 표시
- **이동평균선**: 빠른MA(파란색), 느린MA(빨간색)
- **지지/저항선**: 지지선(초록색), 저항선(빨간색)
- **트렌드 배경**: 상승(연한 초록), 하락(연한 빨강), 횡보(연한 회색)
- **진입 라벨**: 매수/매도 시점에 가격 표시

### 성과 테이블
실시간으로 다음 정보를 표시:
- 총 거래 수
- 승률 (%)
- 수익률 (%)
- 최대 손실
- 현재 포지션 수
- 일일 손익 (%)
- 변동성 (%)

## 🚨 알림 설정

### 알림 종류
1. **매수 신호**: 롱 포지션 진입 조건 충족
2. **매도 신호**: 숏 포지션 진입 조건 충족
3. **긴급 청산**: 긴급 청산 조건 충족

### 알림 메시지 형식
```
매수 조건 충족: SYMBOL at PRICE
매도 조건 충족: SYMBOL at PRICE
긴급 청산 조건 충족: SYMBOL
```

## 🛠️ 사용 방법

### 1. TradingView에서 설정
1. TradingView 차트 열기
2. Pine Editor에서 스크립트 붙여넣기
3. "Add to Chart" 클릭
4. 설정 메뉴에서 매개변수 조정

### 2. 백테스팅
1. Strategy Tester 탭에서 결과 확인
2. 다양한 매개변수로 최적화 진행
3. 승률, 수익률, 최대손실 등 검토

### 3. 실전 적용
1. 알림 설정으로 신호 수신
2. 브로커 API 연동 (별도 설정 필요)
3. 리스크 관리 규칙 준수

## ⚠️ 주의사항

### 리스크 경고
- **과최적화 위험**: 백테스팅 결과가 실전과 다를 수 있음
- **시장 변화**: 시장 환경 변화에 따른 전략 성과 변동 가능
- **슬리피지**: 실제 체결가와 신호가의 차이 발생 가능

### 권장사항
- **소액 테스트**: 실전 적용 전 소액으로 테스트
- **지속적 모니터링**: 성과 추적 및 매개변수 조정
- **리스크 관리**: 설정된 손실 한도 엄격히 준수

## 🔧 커스터마이징

### 매개변수 조정
- **보수적 설정**: 손절 1%, 익절 2%, 포지션 크기 1%
- **적극적 설정**: 손절 3%, 익절 6%, 포지션 크기 5%

### 추가 지표 연동
```pinescript
// MACD 추가
[macd_line, signal_line, _] = ta.macd(close, 12, 26, 9)
macd_bull = macd_line > signal_line

// 볼린저 밴드 추가
[bb_upper, bb_middle, bb_lower] = ta.bb(close, 20, 2)
bb_squeeze = bb_upper - bb_lower < ta.sma(bb_upper - bb_lower, 20)
```

## 📞 지원 및 문의

전략 사용 중 문제가 발생하거나 추가 기능이 필요한 경우:
- 매개변수 최적화 지원
- 커스텀 지표 추가
- 브로커 API 연동 지원

---

**면책조고**: 이 전략은 교육 목적으로 제공되며, 실제 투자 시 발생하는 손실에 대해 책임지지 않습니다. 투자는 본인의 판단과 책임 하에 진행하시기 바랍니다.